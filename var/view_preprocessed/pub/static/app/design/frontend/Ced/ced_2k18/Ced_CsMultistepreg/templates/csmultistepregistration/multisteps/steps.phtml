<?php /** * CedCommerce * * NOTICE OF LICENSE * * This source file is subject to the End User License Agreement (EULA) * that is bundled with this package in the file LICENSE.txt. * It is also available through the world-wide-web at this URL: * http://cedcommerce.com/license-agreement.txt * * @category Ced * @package Ced_CsMultistepregistration * @author CedCommerce Core Team <connect@cedcommerce.com> * @copyright Copyright CedCommerce (http://cedcommerce.com/) * @license http://cedcommerce.com/license-agreement.txt */ ?> <?php $helper = $this->helper('Ced\CsMarketplace\Helper\Tool\Image'); $logo = $helper->getStoreConfig("ced_loginsignup/header/logo",$this->getCurrentStoreId()) ? "ced/csmarketplace/".$helper->getStoreConfig("ced_loginsignup/header/logo",$this->getCurrentStoreId()) : ''; $logoImage = $helper->getResizeImage($logo, 'logo', 335, 106); $footerContent = $helper->getStoreConfig("ced_csmarketplace/general/footer_content",$this->getCurrentStoreId()); $isfooterEnable = $helper->getStoreConfig("ced_csmarketplace/general/enable_footer",$this->getCurrentStoreId()); ?> <div class="ced_vendor_header"><div class="container"><div class="row"><div class="col-xs-12"><div class="pull-left"><div class="v_header_logo"><?php if($logo):?> <a href="<?php echo $this->getBaseUrl(); ?>" target="_blank"><img src="<?php echo $logoImage ?>" alt="vendor panel logo"></a> <?php else:?> <a href="<?php echo $this->getBaseUrl(); ?>" target="_blank"><img src="<?php echo $block->getViewFileUrl('images/demo.png'); ?>" alt="vendor panel logo"></a> <?php endif;?></div></div></div></div></div></div><?php $vendorId = $this->request->get('id'); $collection = $this->getcollection(); $counter = 0; $count = 0; $vmodel = $this->vendorData; $bar = 10; if(!empty($collection)){ $count=$collection->count(); } $stepsData = []; $stepsCount = 0; if ($count > 0) { ?> <div class="multistep-wrapper"><div id="myProgress" class="multistep-progress-bar"><?php foreach ($collection as $steps) {?> <?php $attribute_coll = $this->getStepattributes($steps->getStepNumber()); $attribute_count = $attribute_coll->count(); if($attribute_count==0){ continue; } $stepsData[] = ['stepId'=> $steps->getId(), 'stepNumber'=> $steps->getStepNumber(), 'stepAttributes'=>$attribute_coll]; $stepsCount++; ?> <li id="bar_<?php echo $bar?>" class="waiting"><div class="li-inner"><span tittle="<?php echo __($steps->getStepLabel())?>"></span></div><strong><?php echo __($steps->getStepLabel())?></strong></li> <!-- <div id="bar_<?php ?>" class="waiting"><strong><?php ?></strong></div> --><?php $bar++; }?></div><div class="ced_vendor_before_wrap clearfix"><div class="right"><h3 class="ced_vendor_from_title"><?php echo __('Multi Step Registration'); ?></h3><div class="register-panel panel panel-default form-section"><div class=""><div id="show_required"></div><form action="<?php echo $block->getUrl('csmultistep/multistep/save');?>" method="post" id="vendor-validate" enctype="multipart/form-data"><input name='form_key' type='hidden' value= "<?php echo $block->getBlockHtml('form_key')?>"/><input name="vendor_id" type="hidden" value="<?php echo $vendorId ?>"/><input name="vendor[multistep_done]" type="hidden" value="<?php echo true ?>"/><fieldset><div class="panel panel-default"><?php $stepCount = 1; foreach ($stepsData as $stepData) { /*foreach ($collection as $steps) {*/ $attribute_coll = $stepData['stepAttributes']; $attribute_count = 2; ?> <div id="step_<?php echo $stepCount?>" class="step" style='display: none'><?php if ($attribute_count >= 1) { if(!$attribute_coll) continue; foreach ($attribute_coll as $attr) { $inputType = $attr->getFrontend()->getInputType(); $required_attr = $attr->getIsRequired(); $attribute_class = $attr->getFrontendClass(); $imgflag = false; if ($inputType == 'image' || $inputType == 'file') { $imgflag = true; $inputType = 'file'; } ?> <div class="input-box"><label class="<?php if ($required_attr){ /* echo "label_required"; */}?>"><?php echo $attr->getFrontend()->getLabel()?><span><?php if($required_attr){ echo "*";};?></span></label> <?php if ($inputType == 'select') { ?> <select id="<?php echo $attr->getAttributeCode()?>" name="vendor[<?php echo $attr->getAttributeCode()?>]" class="validate-select <?php if ($required_attr){ echo "required-entry".$stepCount; echo " required-entry";}?> <?php echo $attribute_class;?>"><?php $c = 1; foreach ($attr->getSource()->getAllOptions(true,true) as $key => $opt) { if($key == 0) continue; $attr_option = ''; if (is_array($opt)) { $attr_option_value = $opt['value']; $attr_option_label = $opt['label']; }else{ $attr_option_value = $key; $attr_option_label = $opt->getText(); } ?> <option value="<?php echo $attr_option_value;?>" <?php if(isset($vmodel[$attr->getAttributeCode()]) && $attr_option_value == $vmodel[$attr->getAttributeCode()]){echo 'selected';}?> ><?php echo _($attr_option_label)?></option><?php $c++;}?></select> <label class="addafter"><span class="note afterelment"><?php echo __('Select '.$attr->getFrontend()->getLabel()); ?></span></label> <?php } else if ($inputType == 'boolean') { ?> <select id="<?php echo $attr->getAttributeCode()?>" name="vendor[<?php echo $attr->getAttributeCode()?>]" class="validate-select <?php if ($required_attr){ echo "required-entry".$stepCount; echo " required-entry";}?> <?php echo $attribute_class;?>"><option value="1" <?php if(isset($vmodel[$attr->getAttributeCode()]) && 1 == $vmodel[$attr->getAttributeCode()]){echo 'selected';}?>><?php echo _('Yes')?></option><option value="0" <?php if(isset($vmodel[$attr->getAttributeCode()]) && 0 == $vmodel[$attr->getAttributeCode()]){echo 'selected';}?>><?php echo _('No')?></option></select> <label class="addafter"><span class="note afterelment"><?php echo __('Select '.$attr->getFrontend()->getLabel()); ?></span></label> <?php } else if ($inputType == 'multiselect') { ?> <select id="<?php echo $attr->getAttributeCode()?>" name="vendor[<?php echo $attr->getAttributeCode()?>][]" class="select multiselect <?php if ($required_attr){ echo "required-entry".$stepCount; echo " required-entry";}?> <?php echo $attribute_class; ?>" multiple="multiple"><?php foreach ($attr->getSource()->getAllOptions(true,true) as $key=>$opt) { if($key == 0) continue; ?> ?> <option value="<?php echo $opt['value'];?>" <?php if(isset($vmodel[$attr->getAttributeCode()]) && $opt['value'] == $vmodel[$attr->getAttributeCode()]){echo 'selected';}?>><?php echo _($opt['label'])?></option><?php }?></select> <label class="addafter"><span class="note afterelment"><?php echo __('Select '.$attr->getFrontend()->getLabel()); ?></span></label> <?php } elseif($inputType == 'date'){ ?> <input type="text" name="vendor[<?php echo $attr->getAttributeCode()?>]" id="<?php echo $attr->getAttributeCode()?>" value="<?php if(isset($vmodel[$attr->getAttributeCode()])){echo $vmodel[$attr->getAttributeCode()];}?>" title="<?php echo $attr->getFrontend()->getLabel() ?>" placeholder="<?php echo $attr->getFrontend()->getLabel() ?>" class="<?php if ($required_attr){ echo "required-entry".$stepCount; echo " required-entry";}?> <?php echo $attribute_class?> calendarInput" ><label class="addafter"><span class="note afterelment"><?php echo __('Select '.$attr->getFrontend()->getLabel()); ?></span></label> <?php } elseif($inputType == 'textarea'){ ?> <textarea mage-validate = '{""}' placeholder="<?php echo $attr->getFrontend()->getLabel() ?>" name="vendor[<?php echo $attr->getAttributeCode()?>]" id="<?php echo $attr->getAttributeCode()?>"  
															title="<?php echo $attr->getFrontend()->getLabel() ?>"
															<?php if ($attr->getAttributeCode() == 'email' || $attr->getAttributeCode() == 'shop_url'){echo 'readonly';}?>
															class="<?php if ($required_attr){ echo "required-entry".$stepCount; echo "  required-entry";}?> <?php echo $attribute_class?> "
														><?php if(isset($vmodel[$attr->getAttributeCode()])){echo $vmodel[$attr->getAttributeCode()];}?></textarea> <?php } else {?> <?php if($imgflag){ ?> <div class="img-div"><?php } ?> <input mage-validate = '{""}' placeholder="<?php echo $attr->getFrontend()->getLabel() ?>" type="<?php echo $inputType?>" name="vendor[<?php echo $attr->getAttributeCode()?>]" id="<?php echo $attr->getAttributeCode()?>" value="<?php if(isset($vmodel[$attr->getAttributeCode()])){echo $vmodel[$attr->getAttributeCode()];}?>" title="<?php echo $attr->getFrontend()->getLabel() ?>" <?php if ($attr->getAttributeCode() == 'email' || $attr->getAttributeCode() == 'shop_url'){echo 'readonly';}?> class="<?php if ($required_attr){ echo "required-entry".$stepCount; echo " required-entry";}?> <?php echo $attribute_class?> " /><?php if($imgflag){ ?> <label for="<?php echo $attr->getAttributeCode()?>" class="browse_type_label"><?php echo __('No file selected.'); ?></label> <label class="addafter"><span class="note afterelment"><?php echo __('Select '.$attr->getFrontend()->getLabel()); ?></span></label></div><?php } ?> <?php }?></div><?php } ?> <div class="buttons-set"><button type="button" title="Log Out" style="float:left" class="uptransform button btn btn-success" onclick=" location.href = '<?php echo $block->getUrl('csmarketplace/account/logout/',array('_secure'=>true));?>'">Log Out</button> <input type="button" <?php if($stepCount == 1){echo 'disabled';}?> id="<?php echo $stepCount?>" class="uptransform button btn btn-success back" value="<?php echo __('Back') ?>"/><?php if($stepCount == $stepsCount){ ?> <input type="submit" value = 'submit' id="step<?php echo $stepData['stepId']?>_next" class="uptransform button btn btn-success btnSubmit_form" value="<?php echo __('Submit') ?>"/><?php }else{ ?> <input type="button" id="<?php echo $stepCount?>" class="uptransform button btn btn-success next btnSubmit_form" value="<?php echo __('Next') ?>"/><?php } ?></div><?php }else{ ?> <div class="buttons-set"><button type="button" title="Log Out" style="float:left" class="uptransform button btn btn-success" onclick=" location.href = '<?php echo $block->getUrl('csmarketplace/account/logout/',array('_secure'=>true));?>'">Log Out</button> <input type="button" <?php if($stepCount == 1){echo 'disabled';}?> id="<?php echo $stepCount?>" class="uptransform button btn btn-success back" value="<?php echo __('Back') ?>"/><input type="button" id="<?php echo $stepCount?>" class="uptransform button btn btn-success next btnSubmit_form" value="<?php echo __('Next') ?>"/></div><?php } ?></div><?php $stepCount++; }?></div></fieldset></form></div></div></div></div></div><?php }else { ?> <script type="text/javascript">location.href = '<?php echo $block->getBaseUrl().'marketplace/vendor/index';  ?>';</script><?php }?> <script>
	var validationPassed = true;</script><script type="text/javascript">
require(['jquery'], function($){ 
	var $ = jQuery.noConflict();
	var valid = true;
	if(jQuery('#step_1').length){
		var bar = 10;
		jQuery('#step_1').show();
		jQuery('#bar_10').removeClass('waiting');
		jQuery('#bar_10').addClass('active');
	}
	
	jQuery('.next').click(function() {
		valid = true;
		var id = parseInt(jQuery(this).attr('id'));
		jQuery(".error").remove();
		jQuery('.required-entry'+id).each(function () {
			jQuery(this).removeClass('validation-failed');
			if(!jQuery.trim(jQuery(this).val())) {
				jQuery(this).addClass('validation-failed');
			    	jQuery('<div class="validation-advice error" id="advice-required-entry-pass">This is a required field.</div>').
					insertAfter(this);
					valid = false;
		    }
		});
		

		var inputs = jQuery("#step_"+id+" :input");
		inputs.each(function(){
			
			if(jQuery(this).hasClass('validate-number')){
				var val = jQuery(this).val();
				var regexp = /^\d+\.\d{0,2}$/;	
				if(!regexp.test(val)){
					if(!/^\d*$/.test(val)){
						jQuery(this).addClass('validation-failed');
				    	jQuery('<div class="validation-advice error" id="advice-required-entry-pass">Enter A Valid Number.</div>').
						insertAfter(this);
						valid = false;
					}
				}
			}else if(jQuery(this).hasClass('validate-digits')){
				jQuery(this).removeClass('validation-failed');
				var val = jQuery(this).val();
				if(!/^\d*$/.test(val)){
					jQuery(this).addClass('validation-failed');
			    	jQuery('<div class="validation-advice error" id="advice-required-entry-pass">Enter Valid digits.</div>').
					insertAfter(this);
					valid = false;
				}
			}else if(jQuery(this).hasClass('validate-email')){
				jQuery(this).removeClass('validation-failed');
				
				var re = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
				var val = jQuery(this).val();
				
				if(val != '' || val != null || val.length != 0){
				}else{
					if(!re.test(val)){
	    				jQuery(this).addClass('validation-failed');
				    	jQuery('<div class="validation-advice error" id="advice-required-entry-pass">Please Enter Valid Email.</div>').
						insertAfter(this);
						valid = false;
    				}	
				}
    			
			}else if(jQuery(this).hasClass('validate-url')){
				jQuery(this).removeClass('validation-failed');
				var regexUrl = '/^(http|https|ftp):\/\/(([A-Z0-9]([A-Z0-9_-]*[A-Z0-9]|))(\.[A-Z0-9]([A-Z0-9_-]*[A-Z0-9]|))*)(:(\d+))?(\/[A-Z0-9~](([A-Z0-9_~-]|\.)*[A-Z0-9~]|))*\/?$/i';
				
				var val = jQuery(this).val();
				if(!regexUrl.test(val)){
					jQuery(this).addClass('validation-failed');
			    	jQuery('<div class="validation-advice error" id="advice-required-entry-pass">Please Enter Valid Url.</div>').
					insertAfter(this);
					valid = false;
				}
			}else if(jQuery(this).hasClass('validate-alpha')){
				jQuery(this).removeClass('validation-failed');
				var regexAlpha = /^[a-zA-Z]+$/;
				var val = jQuery(this).val();
				if(!regexAlpha.test(val)){
					jQuery(this).addClass('validation-failed');
			    	jQuery('<div class="validation-advice error" id="advice-required-entry-pass">Please Enter Valid Alphabets.</div>').
					insertAfter(this);
					valid = false;
				}
			}else if(jQuery(this).hasClass('validate-alphanum')){
				jQuery(this).removeClass('validation-failed');
				var regexAlphanum = /^[a-zA-Z0-9]+$/;
				var val = jQuery(this).val();
				if(!regexAlphanum.test(val)){
					jQuery(this).addClass('validation-failed');
			    	jQuery('<div class="validation-advice error" id="advice-required-entry-pass">Please Enter Valid Alphabets And Numbers.</div>').
					insertAfter(this);
					valid = false;
				}
			}

		});


		if(valid) {
			var current = parseInt(jQuery(this).attr('id'));
			var next = current + 1;
			var bar_current = bar;
			var bar_next = bar_current + 1;
			bar = bar_next;
			
			jQuery('#step_'+next).show();
			jQuery('#step_'+current).hide();
			jQuery('#bar_'+bar_current).removeClass('active');
			jQuery('#bar_'+bar_next).removeClass('waiting');
			jQuery('#bar_'+bar_current).addClass('done');
			jQuery('#bar_'+bar_next).addClass('active');
		}
	});

	jQuery('.back').click(function() {
		var current = parseInt(jQuery(this).attr('id'));
		var prev = current - 1;
		bar_current = bar;
		bar_prev = bar_current - 1;
		bar = bar_prev;
		jQuery('#step_'+prev).show();
		jQuery('#step_'+current).hide();
		jQuery('#bar_'+bar_current).removeClass('active');
		jQuery('#bar_'+bar_prev).removeClass('done');
		jQuery('#bar_'+bar_current).addClass('waiting');
		jQuery('#bar_'+bar_prev).addClass('active');
	});	


	});</script><script>
     require([
          "jquery",
          "mage/calendar"
     ], function($){
         $(".calendarInput").calendar({
              buttonText:"<?php echo __('Select Date') ?>",
         });
       });</script><script type="text/javascript">
	require([
    'jquery',
    'mage/mage'
	], function($){
		$(document).ready(function(){
			$('.ced_vendor_before_wrap .input-box .img-div input').change(function(e){
	            var fileName = e.target.files[0].name;
	            $($($(this).closest('.img-div')).find('.browse_type_label')).addClass('active');
	            $($($(this).closest('.img-div')).find('.browse_type_label')).text( fileName );
	        });
		});
	});</script><script type="text/x-magento-init">
    {
        "#vendor-validate": {
            "validation": {}
        },
        "#country_id": {
            "regionUpdater": {
                "optionalRegionAllowed": <?php  echo($block->getConfig('general/region/display_all') ? 'true' : 'false'); ?>,
                "regionListId": "#region_id",
                "regionInputId": "#region",
                "postcodeId": "#zip_code",
                "form": "#vendor-validate",
                "regionJson": <?php  echo $this->helper('Magento\Directory\Helper\Data')->getRegionJson() ?>,
                "defaultRegion": "<?php echo $block->getRegionId() ?>",
                "countriesWithOptionalZip": <?php  echo $this->helper('Magento\Directory\Helper\Data')->getCountriesWithOptionalZip(true) ?> }
        }
    }</script><script type="text/x-magento-init">
    {
        "#vendor-validate": {
            "validation": {}
        }
    }</script><?php if($isfooterEnable):?> <div class="ced_vendor_footer"><div class="container"><div class="row"><div class="col-xs-12"><div class="ced_vendor_footer_links"><ul><li> <a href="<?php echo $this->getBaseUrl(); ?>"><?php echo __('Home') ?></a> |</li> <li> <a href="<?php echo $this->getBaseUrl().'contact'; ?>"><?php echo __('Contact') ?></a> |</li> <!--<li> <a href="<?php ?>"><?php ?></a></li>--></ul></div><p><?php echo $footerContent; ?></p></div></div></div></div><?php endif;?>